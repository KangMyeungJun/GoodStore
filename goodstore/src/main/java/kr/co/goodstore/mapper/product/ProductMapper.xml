<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.co.goodstore.mapper.product.ProductMapper">

<resultMap type="pld" id="pldResult">
<result column="rnum" property="rnum"/>
<result column="item_id" property="item_id"/>
<result column="item_name" property="item_name"/>
<result column="image" property="image"/>
<result column="upload_date" property="upload_date"/>
<result column="price" property="price"/>
<result column="com_name" property="com_name"/>
<result column="com_type" property="com_type"/>
<result column="wish_count" property="wish_count"/>
</resultMap>
<select id="productList" parameterType="plVO" resultMap="pldResult">
select row_number() over(order by price) rnum, i.item_id, i.item_name, i.image, i.upload_date, 
i.price, c.name com_name, c.type com_type, nvl(w.wish_count,0) wish_count
from item i
INNER JOIN company c
ON i.company_id = c.company_id
LEFT OUTER JOIN (select item_id, count(*) wish_count from wishlist group by item_id) w
ON i.item_id = w.item_id
</select>

<resultMap type="pd" id="pdResult">
<result column="item_id" property="item_id"/>
<result column="item_name" property="item_name"/>
<result column="summary" property="summary"/>
<result column="description" property="description"/>
<result column="price" property="price"/>
<result column="image" property="image"/>
<result column="additional_info" property="additional_info"/>
<result column="com_name" property="com_name"/>
<result column="com_type" property="com_type"/>
<result column="category_name" property="category_name"/>
</resultMap>
<select id="productDetail" parameterType="int" resultMap="pdResult">
select i.item_id, item_name,summary,description,price,i.image,additional_info, 
		c.name com_name, c.type com_type, category_name
from item i
JOIN company c
on i.company_id = c.company_id
JOIN category cat
on i.category_id = cat.category_id
where i.item_id = #{item_id}
</select>
<select id="subImage" parameterType="int" resultType="sid">
select item_id, sub_image
from sub_image
where item_id=#{item_id}
</select>
<select id="productComment" parameterType="int" resultType="pcd">
select review, item_id, email, star, upload_date
from item_comment i
join member m
on i.member_id = m.member_id
where item_id=#{item_id}
</select>
</mapper>